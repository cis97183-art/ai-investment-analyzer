# portfolio_rules.py

# ==================================
# 規則一：風險偏好標的篩選規則
# ==================================
# 使用 lambda 函式來定義篩選條件，這樣更靈活且易於調用
SCREENING_RULES = {
    '保守型': {
        'tiers': {
            1: lambda df: (df['一年(σ年)'] < 15) & (df['一年(β)'] < 0.6) & (df['現金股利連配次數'] > 10) & (df['成交價現金殖利率'] > 4),
            2: lambda df: (df['一年(σ年)'] < 20) & (df['一年(β)'] < 0.8) & (df['現金股利連配次數'] > 5) & (df['成交價現金殖利率'] > 3),
            3: lambda df: (df['一年(σ年)'] < 25) & (df['一年(β)'] < 1.0) & (df['現金股利連配次數'] > 3) & (df['成交價現金殖利率'] > 0)
        },
        'sort_by': ['市值(億)', '最新季度負債總額佔比(%)'],
        'ascending': [False, True]
    },
    '穩健型': {
        'tiers': {
            1: lambda df: (df['一年(σ年)'] >= 15) & (df['一年(σ年)'] < 30) & (df['一年(β)'] >= 0.8) & (df['一年(β)'] <= 1.2) & (df['近3年平均ROE(%)'] > 8),
            2: lambda df: (df['一年(σ年)'] >= 20) & (df['一年(σ年)'] < 35) & (df['一年(β)'] >= 0.7) & (df['一年(β)'] <= 1.3) & (df['近3年平均ROE(%)'] > 5),
            3: lambda df: (df['一年(β)'] > 0.6) # 特殊規則，會在 screener.py 中處理
        },
        'sort_by': ['近3年平均ROE(%)', '累月營收年增(%)'],
        'ascending': [False, False]
    },
    '積極型': {
        'tiers': {
            1: lambda df: (df['一年(σ年)'] > 40) & (df['一年(β)'] > 1.4) & (df['累月營收年增(%)'] > 20),
            2: lambda df: (df['一年(σ年)'] > 35) & (df['一年(β)'] > 1.2) & (df['累月營收年增(%)'] > 10),
            3: lambda df: (df['一年(σ年)'] > 30) & (df['一年(β)'] > 1.1)
        },
        'sort_by': ['累月營收年增(%)', '最新單季ROE(%)'],
        'ascending': [False, False]
    }
}

# ==================================
# 規則二：投資組合建構規則
# ==================================
PORTFOLIO_CONSTRUCTION_RULES = {
    '純個股': {
        'min_assets': 5,
        'max_assets': 10,
        'max_industry_assets': 2,
        'hhi_limit': 0.25
    },
    '純 ETF': {
        'min_assets': 2,
        'max_assets': 4,
    },
    '混合型': {
        'core_etfs': 2,
        'satellite_stocks': 5,
        'core_weight': 0.7,
        'hhi_limit': 0.3
    }
}